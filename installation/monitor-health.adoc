---
sidebar: sidebar 
permalink: installation/monitor-health.html 
keywords: monitoring system health 
summary: 為了確保資料可用，您可以使用任何支援 HTTP 請求的監控系統來監控Keystone Collector 的健康狀況。 
---
= 監控Keystone Collector 的健康狀況
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
您可以使用任何支援 HTTP 請求的監控系統來監控Keystone Collector 的健康狀況。監控健康狀況有助於確保Keystone儀表板上的資料可用。

預設情況下， Keystone健康服務不接受 localhost 以外的任何 IP 的連線。 Keystone健康端點是 `/uber/health`，並在連接埠上監聽Keystone Collector 伺服器的所有介面 `7777`。查詢時，端點將傳回一個帶有 JSON 輸出的 HTTP 請求狀態碼作為回應，描述Keystone Collector 系統的狀態。 JSON 主體提供了 `is_healthy`屬性，它是一個布林值；以及每個組件的詳細狀態列表 `component_details`屬性。以下是一個例子：

[listing]
----
$ curl http://127.0.0.1:7777/uber/health
{"is_healthy": true, "component_details": {"vicmet": "Running", "ks-collector": "Running", "ks-billing": "Running", "chronyd": "Running"}}
----
傳回以下狀態代碼：

* *200*：表示所有被監控的組件都是健康的
* *503*：表示一個或多個組件不健康
* *403*：表示查詢健康狀態的 HTTP 用戶端不在_允許_清單中，該清單是允許的網路 CIDR 清單。對於此狀態，不會傳回任何健康資訊。 _allow_ 清單使用網路 CIDR 方法來控制哪些網路設備被允許查詢Keystone健康系統。如果您收到此錯誤，請從 * Keystone Collector 管理 TUI > 設定 > 健康監控* 將您的監控系統新增至_允許_清單。


.Linux 用戶請注意此已知問題：

NOTE: *問題描述*： Keystone Collector 作為使用計量系統的一部分運行許多容器。當使用美國國防資訊系統局 (DISA) 安全技術實施指南 (STIG) 策略強化 Red Hat Enterprise Linux 8.x 伺服器時，會間歇性地出現 fapolicyd (檔案存取策略守護程序) 的已知問題。該問題被認定為link:https://bugzilla.redhat.com/show_bug.cgi?id=1907870["錯誤 1907870"^]。 *解決方法*：在 Red Hat Enterprise 解決之前， NetApp建議您透過以下方式解決此問題： `fapolicyd`進入寬容模式。在/`etc/fapolicyd/fapolicyd.conf`，設定值 `permissive = 1`。



== 查看系統日誌

您可以查看Keystone Collector 系統日誌來查看系統資訊並使用這些日誌執行故障排除。 Keystone Collector 使用主機的 _journald_ 日誌系統，並且可以透過標準 _journalctl_ 系統實用程式查看系統日誌。您可以使用以下關鍵服務來檢查日誌：

* ks-收集器
* ks-健康
* ks-自動更新


主要資料收集服務 _ks-collector_ 產生 JSON 格式的日誌，其中包含 `run-id`與每個計劃資料收集作業相關的屬性。以下是標準使用資料收集成功作業的範例：

[listing]
----
{"level":"info","time":"2022-10-31T05:20:01.831Z","caller":"light-collector/main.go:31","msg":"initialising light collector with run-id cdflm0f74cgphgfon8cg","run-id":"cdflm0f74cgphgfon8cg"}
{"level":"info","time":"2022-10-31T05:20:04.624Z","caller":"ontap/service.go:215","msg":"223 volumes collected for cluster a2049dd4-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:18.821Z","caller":"ontap/service.go:215","msg":"697 volumes collected for cluster 909cbacc-bfcf-11ec-8500-00505695ce60","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:41.598Z","caller":"ontap/service.go:215","msg":"7 volumes collected for cluster f7b9a30c-55dc-11ed-9c88-005056b3d66f","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.247Z","caller":"ontap/service.go:215","msg":"24 volumes collected for cluster a9e2dcff-ab21-11ec-8428-00a098ad3ba2","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.786Z","caller":"worker/collector.go:75","msg":"4 clusters collected","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.839Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193648.tar.gz type=ontap to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:48.840Z","caller":"reception/reception.go:76","msg":"File bytes 123425","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}
----
以下是可選效能資料收集成功作業的範例：

[listing]
----
{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:28","msg":"initialising MySql service at 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:55","msg":"Opening MySql db connection at server 10.128.114.214"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sql/service.go:39","msg":"Creating MySql db config object"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:69","msg":"initialising SLA service"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"sla_reporting/service.go:71","msg":"SLA service successfully initialised"}

{"level":"info","time":"2022-10-31T05:20:51.324Z","caller":"worker/collector.go:217","msg":"Performance data would be collected for timerange: 2022-10-31T10:24:52~2022-10-31T10:29:52"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"worker/collector.go:244","msg":"New file generated: 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz"}

{"level":"info","time":"2022-10-31T05:21:31.385Z","caller":"reception/reception.go:75","msg":"Sending file 65a71542-cb4d-bdb2-e9a7-a826be4fdcb7_1667193651.tar.gz type=ontap-perf to reception","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:31.386Z","caller":"reception/reception.go:76","msg":"File bytes 17767","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"reception/reception.go:99","msg":"uploaded usage file to reception with status 201 Created","run-id":"cdflm0f74cgphgfon8cg"}

{"level":"info","time":"2022-10-31T05:21:33.025Z","caller":"light-collector/main.go:88","msg":"exiting","run-id":"cdflm0f74cgphgfon8cg"}
----


== 產生並收集支援包

Keystone Collector TUI 可讓您產生支援包並將其新增至服務請求以解決支援問題。請遵循以下步驟：

.步驟
. 啟動Keystone Collector 管理 TUI 公用程式：
`$ keystone-collector-tui`
. 前往*故障排除>產生支援包*。image:tui-sup-bundl.png["tui螢幕"]
. 產生後，會顯示該包的儲存位置。使用 FTP、SFTP 或 SCP 連接到該位置並將日誌檔案下載到本機系統。image:tui-sup-bundl-2.png["tui螢幕"]
. 下載檔案後，您可以將其附加到Keystone ServiceNow 支援票證。有關提出票證的信息，請參閱link:../concepts/gssc.html["產生服務請求"]。

